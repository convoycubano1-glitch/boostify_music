import { useState } from "react";
import { motion } from "framer-motion";
import { Card } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { ScrollArea } from "@/components/ui/scroll-area";
import { Badge } from "@/components/ui/badge";
import {
  Play,
  Pause,
  Music2,
  Video as VideoIcon,
  FileText,
  ChartBar,
  User,
  MapPin,
  Mail,
  Phone,
  Globe,
  Instagram,
  Twitter,
  Youtube,
  Share2,
  Calendar,
  CalendarRange,
  HeartPulse,
  Users,
  DollarSign,
  Loader2,
  ShoppingBag,
  ShoppingCart,
  Store,
  Ticket,
  TicketCheck,
  MessageCircle,
  MessageSquare,
  Shirt,
  Paintbrush,
  Check,
  X,
  Link as LinkIcon,
  PlusCircle,
  Info,
  Music4,
  DownloadCloud,
  CreditCard
} from "lucide-react";
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from "@/components/ui/dialog";
import { CircularProgressbar, buildStyles } from "react-circular-progressbar";
import "react-circular-progressbar/dist/styles.css";
import { Link } from "wouter";
import { useQuery } from "@tanstack/react-query";
import { collection, getDocs, query, where } from "firebase/firestore";
import { db } from "@/lib/firebase";
import { useToast } from "@/hooks/use-toast";

export interface ArtistProfileProps {
  artistId: string;
}

interface Song {
  id: string;
  name: string;
  title?: string;
  duration?: string;
  audioUrl: string;
  userId: string;
  createdAt?: any;
  storageRef?: string;
}

interface Video {
  id: string;
  title: string;
  thumbnailUrl?: string;
  url: string;
  userId: string;
  createdAt?: any;
}

// Add ShareDialog component
const ShareDialog = ({ isOpen, onClose, artistName, artistUrl }: { isOpen: boolean; onClose: (value?: boolean | undefined) => void; artistName: string; artistUrl: string }) => {
  const fullUrl = `${window.location.origin}/profile/${artistUrl}`;
  const { toast } = useToast(); // Añadiendo la referencia al hook de toast

  const shareData = {
    facebook: `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(fullUrl)}`,
    twitter: `https://twitter.com/intent/tweet?url=${encodeURIComponent(fullUrl)}&text=Check out ${artistName}'s profile`,
    whatsapp: `https://wa.me/?text=${encodeURIComponent(`Check out ${artistName}'s profile: ${fullUrl}`)}`,
    instagram: `instagram://camera`, // Instagram doesn't support direct sharing, opens the app
    tiktok: `https://www.tiktok.com/upload/`, // TikTok doesn't support direct sharing, opens upload page
  };

  return (
    <Dialog open={isOpen} onOpenChange={onClose}>
      <DialogContent className="sm:max-w-[425px]">
        <DialogHeader>
          <DialogTitle>Share Profile</DialogTitle>
        </DialogHeader>
        <div className="grid gap-4 py-4">
          <Button
            className="w-full bg-[#1877F2] hover:bg-[#166FE5]"
            onClick={() => window.open(shareData.facebook, '_blank')}
          >
            Share on Facebook
          </Button>
          <Button
            className="w-full bg-[#1DA1F2] hover:bg-[1A91DA]"
            onClick={() => window.open(shareData.twitter, '_blank')}
          >
            Share on Twitter/X
          </Button>
          <Button
            className="w-full bg-[#25D366] hover:bg-[#128C7E]"
            onClick={() => window.open(shareData.whatsapp, '_blank')}
          >
            Share on WhatsApp
          </Button>
          <Button
            className="w-full bg-[#E4405F] hover:bg-[#D93248]"
            onClick={() => window.open(shareData.instagram, '_blank')}
          >
            Share on Instagram
          </Button>
          <Button
            className="w-full bg-[#000000] hover:bg-[#333333]"
            onClick={() => window.open(shareData.tiktok, '_blank')}
          >
            Share on TikTok
          </Button>
          <Button
            className="w-full"
            variant="outline"
            onClick={() => {
              navigator.clipboard.writeText(fullUrl);
              toast({
                title: "Link copied!",
                description: "Profile link has been copied to your clipboard.",
              });
            }}
          >
            <LinkIcon className="mr-2 h-4 w-4" />
            Copy Link
          </Button>
        </div>
      </DialogContent>
    </Dialog>
  );
};

export function ArtistProfileCard({ artistId }: ArtistProfileProps) {
  // Estados para la reproducción de música
  const [isPlaying, setIsPlaying] = useState(false);
  const [currentTrack, setCurrentTrack] = useState(0);
  const [currentAudio, setCurrentAudio] = useState<HTMLAudioElement | null>(null);
  
  // Estados para diálogos y navegación
  const [showMessageDialog, setShowMessageDialog] = useState(false);
  const [showShareDialog, setShowShareDialog] = useState(false);
  const [activeSection, setActiveSection] = useState<'music' | 'videos' | 'merch' | 'shows'>('music');
  
  // Componente de navegación por secciones
  const SectionNavigation = () => (
    <div className="flex justify-center my-6 overflow-x-auto">
      <div className="inline-flex items-center bg-black/50 backdrop-blur-sm rounded-full p-1 border border-orange-500/30">
        {[
          { id: 'music', label: 'Music', icon: <Music2 className="w-4 h-4 mr-2" /> },
          { id: 'videos', label: 'Videos', icon: <VideoIcon className="w-4 h-4 mr-2" /> },
          { id: 'shows', label: 'Shows', icon: <Ticket className="w-4 h-4 mr-2" /> },
          { id: 'merch', label: 'Merch', icon: <ShoppingBag className="w-4 h-4 mr-2" /> }
        ].map((section) => (
          <Button
            key={section.id}
            variant={activeSection === section.id ? "default" : "ghost"}
            size="sm"
            className={`rounded-full transition-all duration-300 ${
              activeSection === section.id
                ? "bg-gradient-to-r from-orange-500 to-pink-500 text-white shadow-lg"
                : "text-muted-foreground hover:text-foreground"
            }`}
            onClick={() => setActiveSection(section.id as 'music' | 'videos' | 'merch' | 'shows')}
          >
            {section.icon}
            {section.label}
          </Button>
        ))}
      </div>
    </div>
  );
  
  // Estado para reproductor de audio
  const [duration, setDuration] = useState(0);
  const [currentTime, setCurrentTime] = useState(0);
  const [isAudioLoading, setIsAudioLoading] = useState(false);
  
  const { toast } = useToast();

  // Query optimizada para obtener canciones
  const { data: songs = [], isLoading: isLoadingSongs } = useQuery({
    queryKey: ["songs", artistId],
    queryFn: async () => {
      try {
        const songsRef = collection(db, "songs");
        const q = query(songsRef, where("userId", "==", artistId));
        const querySnapshot = await getDocs(q);

        if (querySnapshot.empty) {
          return [];
        }

        const songData = querySnapshot.docs.map((doc) => {
          const data = doc.data();
          return {
            id: doc.id,
            name: data.name,
            title: data.name,
            audioUrl: data.audioUrl,
            duration: data.duration || "3:45", // Default duration
            userId: data.userId,
            createdAt: data.createdAt?.toDate(),
            storageRef: data.storageRef,
            coverArt: data.coverArt || '/assets/freepik__boostify_music_organe_abstract_icon.png'
          };
        });

        return songData;
      } catch (error) {
        console.error("Error fetching songs:", error);
        toast({
          title: "Error",
          description: "No se pudieron cargar las canciones",
          variant: "destructive",
        });
        return [];
      }
    },
    enabled: !!artistId
  });

  // Query optimizada para obtener videos
  const { data: videos = [], isLoading: isLoadingVideos } = useQuery({
    queryKey: ["videos", artistId],
    queryFn: async () => {
      try {
        const videosRef = collection(db, "videos");
        const q = query(videosRef, where("userId", "==", artistId));
        const querySnapshot = await getDocs(q);

        if (querySnapshot.empty) {
          return [];
        }

        const videoData = querySnapshot.docs.map((doc) => {
          const data = doc.data();
          const videoId = data.url?.split('v=')?.[1] || data.url?.split('/')?.[3]?.split('?')?.[0];
          return {
            id: doc.id,
            title: data.title,
            url: data.url,
            thumbnail: data.thumbnailUrl || (videoId ? `https://img.youtube.com/vi/${videoId}/mqdefault.jpg` : undefined),
            videoId: videoId,
            createdAt: data.createdAt?.toDate(),
            views: Math.floor(Math.random() * 10000) + 1000, // Datos de muestra para mejorar UX
            likes: Math.floor(Math.random() * 500) + 50,
          };
        });

        return videoData;
      } catch (error) {
        console.error("Error fetching videos:", error);
        toast({
          title: "Error",
          description: "No se pudieron cargar los videos",
          variant: "destructive",
        });
        return [];
      }
    },
    enabled: !!artistId
  });

  const togglePlay = (song: Song, index: number) => {
    // Si ya estamos reproduciendo esta canción, la pausamos
    if (isPlaying && currentTrack === index && currentAudio) {
      currentAudio.pause();
      setIsPlaying(false);
      return;
    }
    
    // Si hay un audio reproduciéndose, lo detenemos primero
    if (currentAudio) {
      currentAudio.pause();
      currentAudio.removeEventListener('ended', () => setIsPlaying(false));
      setCurrentAudio(null);
      setIsPlaying(false);
    }

    // Reproducimos la nueva canción
    if (song.audioUrl) {
      const audio = new Audio(song.audioUrl);

      audio.addEventListener('ended', () => {
        setIsPlaying(false);
        setCurrentAudio(null);
      });

      audio.addEventListener('error', (error) => {
        console.error("Error playing audio:", error);
        toast({
          title: "Error",
          description: "No se pudo reproducir el audio. Por favor, intente nuevamente.",
          variant: "destructive",
        });
        setIsPlaying(false);
        setCurrentAudio(null);
      });

      audio.play().catch((error) => {
        console.error("Error playing audio:", error);
        toast({
          title: "Error",
          description: "No se pudo reproducir el audio",
          variant: "destructive",
        });
      });
      setCurrentAudio(audio);
      setCurrentTrack(index);
      setIsPlaying(true);
    }
  };

  // Función auxiliar para obtener el ID del video de YouTube
  const getYoutubeVideoId = (url: string): string => {
    const patterns = [
      /(?:youtube\.com\/watch\?v=|youtu.be\/|youtube.com\/embed\/)([^&\n?#]+)/,
      /^[a-zA-Z0-9_-]{11}$/
    ];

    for (const pattern of patterns) {
      const match = url.match(pattern);
      if (match && match[1]) {
        return match[1];
      }
    }

    return '';
  };

  const containerVariants = {
    hidden: { opacity: 0, y: 20 },
    visible: {
      opacity: 1,
      y: 0,
      transition: {
        duration: 0.6,
        staggerChildren: 0.1,
      },
    },
  };

  const itemVariants = {
    hidden: { opacity: 0, x: -20 },
    visible: {
      opacity: 1,
      x: 0,
      transition: { duration: 0.3 },
    },
  };

  // Función para formatear el tiempo de reproducción
  const formatTime = (seconds: number): string => {
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins}:${secs < 10 ? '0' + secs : secs}`;
  };

  // Componente para mostrar el progreso de reproducción
  const AudioProgressBar = () => {
    if (!currentAudio || currentTrack === -1) return null;
    
    return (
      <div className="fixed bottom-0 left-0 right-0 bg-gradient-to-r from-black/90 to-black/80 backdrop-blur-md p-3 z-50 border-t border-orange-500/20">
        <div className="max-w-7xl mx-auto flex flex-col">
          <div className="flex items-center justify-between w-full mb-2">
            <div className="flex items-center gap-3">
              <Button
                variant="ghost"
                size="icon"
                onClick={() => {
                  if (isPlaying) {
                    currentAudio?.pause();
                    setIsPlaying(false);
                  } else {
                    currentAudio?.play();
                    setIsPlaying(true);
                  }
                }}
                className={`rounded-full transition-transform duration-300 ${
                  isPlaying
                    ? "bg-orange-500 text-white hover:bg-orange-600"
                    : "hover:bg-orange-500/10"
                }`}
              >
                {isPlaying ? (
                  <Pause className="h-5 w-5" />
                ) : (
                  <Play className="h-5 w-5" />
                )}
              </Button>
              <div>
                <span className="font-medium text-white">
                  {songs[currentTrack]?.name || songs[currentTrack]?.title}
                </span>
                <span className="text-sm text-white/70 block">
                  {mockArtist.name}
                </span>
              </div>
            </div>
            <div className="text-sm text-white/70">
              {formatTime(currentTime)} / {formatTime(duration)}
            </div>
          </div>
          
          <div className="w-full bg-gray-700/30 h-1.5 rounded-full overflow-hidden">
            <div 
              className="h-full bg-gradient-to-r from-orange-500 to-pink-500"
              style={{ width: `${(currentTime / duration) * 100}%` }}
            />
          </div>
        </div>
      </div>
    );
  };

  // Sección de música mejorada con diseño de tarjetas
  const MusicSection = () => (
    <Card className="p-6 bg-black/40 backdrop-blur-sm border-orange-500/20 hover:border-orange-500/40 transition-all duration-300 overflow-hidden">
      <motion.div variants={itemVariants}>
        <div className="flex items-center justify-between mb-6">
          <h3 className="text-2xl font-semibold flex items-center bg-clip-text text-transparent bg-gradient-to-r from-orange-500 to-red-500">
            <Music2 className="w-6 h-6 mr-2 text-orange-500" />
            Latest Tracks
          </h3>
          <Button variant="ghost" size="sm" className="text-orange-500 hover:text-orange-400">
            <span>View All</span>
            <ChartBar className="ml-2 h-4 w-4" />
          </Button>
        </div>
        
        <div className="space-y-4">
          {isLoadingSongs ? (
            <div className="flex items-center justify-center p-8">
              <div className="relative">
                <Loader2 className="h-8 w-8 animate-spin text-orange-500" />
                <div className="absolute inset-0 flex items-center justify-center">
                  <Music2 className="h-4 w-4 text-orange-300" />
                </div>
              </div>
              <p className="ml-3 text-orange-300">Cargando pistas...</p>
            </div>
          ) : songs && songs.length > 0 ? (
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              {songs.map((song, index) => (
                <motion.div
                  key={song.id}
                  whileHover={{ scale: 1.02 }}
                  transition={{ duration: 0.2 }}
                  className={`flex items-center p-4 rounded-lg transition-all duration-300 backdrop-blur-sm ${
                    currentTrack === index
                      ? "bg-gradient-to-r from-orange-500/30 to-pink-500/20 border border-orange-500/50"
                      : "bg-black/30 border border-orange-500/10 hover:border-orange-500/30"
                  }`}
                >
                  <div className="flex items-center gap-3 w-full">
                    <div className="relative shrink-0">
                      <div className={`w-12 h-12 rounded-md overflow-hidden bg-orange-500/20 ${
                        currentTrack === index && isPlaying ? 'ring-2 ring-orange-500 ring-offset-1 ring-offset-black' : ''
                      }`}>
                        <img 
                          src={song.coverArt} 
                          alt={song.name} 
                          className="w-full h-full object-cover"
                          onError={(e) => {
                            (e.target as HTMLImageElement).src = '/assets/freepik__boostify_music_organe_abstract_icon.png';
                          }}  
                        />
                      </div>
                      <Button
                        variant="ghost"
                        size="icon"
                        onClick={() => togglePlay(song, index)}
                        className={`absolute -bottom-2 -right-2 w-7 h-7 rounded-full transition-transform duration-300 ${
                          currentTrack === index && isPlaying
                            ? "bg-orange-500 text-white hover:bg-orange-600 scale-110"
                            : "bg-black/70 text-white hover:bg-orange-500/80"
                        }`}
                      >
                        {currentTrack === index && isPlaying ? (
                          <Pause className="h-3 w-3" />
                        ) : (
                          <Play className="h-3 w-3" />
                        )}
                      </Button>
                    </div>
                    
                    <div className="flex-1 min-w-0">
                      <div className="flex justify-between items-start">
                        <span className="font-medium truncate">{song.name || song.title}</span>
                        <span className="text-xs text-muted-foreground ml-2 shrink-0">
                          {song.duration || "3:45"}
                        </span>
                      </div>
                      <span className="text-xs text-muted-foreground block truncate">
                        {song.createdAt ? new Date(song.createdAt).toLocaleDateString() : 'No date'} 
                        {currentTrack === index && isPlaying && <span className="ml-2 text-orange-500">• Reproduciendo</span>}
                      </span>
                    </div>
                  </div>
                </motion.div>
              ))}
            </div>
          ) : (
            <div className="bg-black/20 rounded-lg p-8 text-center">
              <Music2 className="h-12 w-12 text-orange-500/40 mx-auto mb-3" />
              <p className="text-orange-100/70">No hay pistas disponibles</p>
              <p className="text-sm text-orange-300/50 mt-2">Las canciones que subas aparecerán aquí</p>
              <Button variant="outline" className="mt-4 border-orange-500/30 text-orange-400 hover:bg-orange-500/10">
                <PlusCircle className="h-4 w-4 mr-2" />
                Subir música
              </Button>
            </div>
          )}
        </div>
      </motion.div>
    </Card>
  );

  const VideosSection = () => (
    <Card className="p-6 bg-black/40 backdrop-blur-sm border-orange-500/20 hover:border-orange-500/40 transition-all duration-300 overflow-hidden">
      <motion.div variants={itemVariants}>
        <div className="flex items-center justify-between mb-6">
          <h3 className="text-2xl font-semibold flex items-center bg-clip-text text-transparent bg-gradient-to-r from-orange-500 to-red-500">
            <VideoIcon className="w-6 h-6 mr-2 text-orange-500" />
            Latest Videos
          </h3>
          <Button variant="ghost" size="sm" className="text-orange-500 hover:text-orange-400">
            <span>View All</span>
            <ChartBar className="ml-2 h-4 w-4" />
          </Button>
        </div>
        
        <div className="space-y-4">
          {isLoadingVideos ? (
            <div className="flex items-center justify-center p-8">
              <div className="relative">
                <Loader2 className="h-8 w-8 animate-spin text-orange-500" />
                <div className="absolute inset-0 flex items-center justify-center">
                  <VideoIcon className="h-4 w-4 text-orange-300" />
                </div>
              </div>
              <p className="ml-3 text-orange-300">Cargando videos...</p>
            </div>
          ) : videos && videos.length > 0 ? (
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {videos.map((video) => {
                const videoId = video.url ? getYoutubeVideoId(video.url) : '';
                return (
                  <motion.div
                    key={video.id}
                    className="rounded-xl overflow-hidden bg-gradient-to-br from-black/50 to-black/30 border border-orange-500/10 hover:border-orange-500/30 transition-all duration-300 group"
                    whileHover={{ 
                      scale: 1.03,
                      boxShadow: "0 10px 30px -15px rgba(249, 115, 22, 0.4)"
                    }}
                    transition={{ duration: 0.2 }}
                  >
                    <div className="aspect-video relative">
                      <iframe
                        className="w-full h-full rounded-t-lg"
                        src={`https://www.youtube.com/embed/${videoId}?rel=0`}
                        title={video.title}
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowFullScreen
                      ></iframe>
                      
                      {/* Overlay de gradiente en hover */}
                      <div className="absolute inset-0 bg-gradient-to-t from-orange-500/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300" />
                    </div>
                    
                    <div className="p-4">
                      <h4 className="font-medium text-white group-hover:text-orange-300 transition-colors duration-300 line-clamp-1">{video.title}</h4>
                      
                      <div className="flex justify-between items-center mt-2">
                        <p className="text-xs text-white/60">
                          {video.createdAt ? new Date(video.createdAt).toLocaleDateString() : 'No date'}
                        </p>
                        
                        <div className="flex items-center gap-3 text-xs text-white/60">
                          <span className="flex items-center">
                            <HeartPulse className="w-3 h-3 mr-1 text-pink-500" />
                            {video.likes || 0}
                          </span>
                          <span className="flex items-center">
                            <Users className="w-3 h-3 mr-1 text-blue-400" />
                            {video.views || 0}
                          </span>
                        </div>
                      </div>
                    </div>
                  </motion.div>
                );
              })}
            </div>
          ) : (
            <div className="bg-black/20 rounded-lg p-8 text-center">
              <VideoIcon className="h-12 w-12 text-orange-500/40 mx-auto mb-3" />
              <p className="text-orange-100/70">No hay videos disponibles</p>
              <p className="text-sm text-orange-300/50 mt-2">Los videos que subas aparecerán aquí</p>
              <Button variant="outline" className="mt-4 border-orange-500/30 text-orange-400 hover:bg-orange-500/10">
                <PlusCircle className="h-4 w-4 mr-2" />
                Subir video
              </Button>
            </div>
          )}
        </div>
      </motion.div>
    </Card>
  );

  // Componente de navegación de secciones
  const SectionNavigation = () => (
    <Card className="p-3 bg-black/60 backdrop-blur-md border-orange-500/20 sticky top-4 z-30 mb-6">
      <div className="flex justify-between items-center">
        <div className="flex overflow-x-auto gap-1 pb-1 hide-scrollbar">
          <Button 
            size="sm" 
            variant={activeSection === 'music' ? 'default' : 'outline'}
            className={`rounded-full transition-all duration-300 ${
              activeSection === 'music' 
                ? 'bg-orange-500 text-white hover:bg-orange-600' 
                : 'text-orange-500 border-orange-500/30 hover:bg-orange-500/10'
            }`}
            onClick={() => setActiveSection('music')}
          >
            <Music2 className="mr-2 h-4 w-4" />
            Música
          </Button>
          <Button 
            size="sm" 
            variant={activeSection === 'videos' ? 'default' : 'outline'}
            className={`rounded-full transition-all duration-300 ${
              activeSection === 'videos' 
                ? 'bg-orange-500 text-white hover:bg-orange-600' 
                : 'text-orange-500 border-orange-500/30 hover:bg-orange-500/10'
            }`}
            onClick={() => setActiveSection('videos')}
          >
            <VideoIcon className="mr-2 h-4 w-4" />
            Videos
          </Button>
          <Button 
            size="sm" 
            variant={activeSection === 'shows' ? 'default' : 'outline'}
            className={`rounded-full transition-all duration-300 ${
              activeSection === 'shows' 
                ? 'bg-orange-500 text-white hover:bg-orange-600' 
                : 'text-orange-500 border-orange-500/30 hover:bg-orange-500/10'
            }`}
            onClick={() => setActiveSection('shows')}
          >
            <Calendar className="mr-2 h-4 w-4" />
            Shows
          </Button>
          <Button 
            size="sm" 
            variant={activeSection === 'merch' ? 'default' : 'outline'}
            className={`rounded-full transition-all duration-300 ${
              activeSection === 'merch' 
                ? 'bg-orange-500 text-white hover:bg-orange-600' 
                : 'text-orange-500 border-orange-500/30 hover:bg-orange-500/10'
            }`}
            onClick={() => setActiveSection('merch')}
          >
            <ShoppingBag className="mr-2 h-4 w-4" />
            Merchandise
          </Button>
        </div>
        <div className="flex gap-1">
          <Button
            size="sm"
            variant="ghost"
            className="rounded-full hover:bg-orange-500/10 text-orange-500"
            onClick={() => setShowShareDialog(true)}
          >
            <Share2 className="h-4 w-4" />
          </Button>
          <Button
            size="sm"
            variant="ghost"
            className="rounded-full hover:bg-orange-500/10 text-orange-500"
            onClick={() => setShowMessageDialog(true)}
          >
            <MessageCircle className="h-4 w-4" />
          </Button>
        </div>
      </div>
    </Card>
  );

  return (
    <motion.div
      variants={containerVariants}
      initial="hidden"
      animate="visible"
      className="w-full max-w-7xl mx-auto pb-24"
    >
      {/* Añadimos barra de progreso de audio si hay una canción reproduciéndose */}
      {currentAudio && <AudioProgressBar />}
      
      {/* Mostrar diálogos si están activos */}
      <ShareDialog 
        isOpen={showShareDialog}
        onClose={() => setShowShareDialog(false)}
        artistName={mockArtist.name}
        artistUrl={artistId}
      />
      
      <div className="fixed top-4 left-4 z-50">
        <Button
          size="sm"
          className="bg-gradient-to-r from-orange-500 to-pink-500 hover:from-orange-600 hover:to-pink-600 text-white shadow-lg hover:shadow-xl transition-all duration-300 text-xs md:text-sm md:size-lg"
          onClick={() => window.location.href = "/"}
        >
          <PlusCircle className="mr-1 md:mr-2 h-4 w-4 md:h-5 md:w-5" />
          <span className="hidden xs:inline">Create Your Profile</span>
          <span className="xs:hidden">Create</span>
        </Button>
      </div>

      {/* Stats at the top - Responsive for mobile */}
      <motion.div
        className="absolute top-4 md:top-8 right-4 md:right-8 z-10 flex flex-col md:flex-row gap-2 md:gap-4"
        variants={containerVariants}
        initial="hidden"
        animate="visible"
      >
        <motion.div
          className="bg-black/40 backdrop-blur-sm rounded-lg p-2 md:p-4 flex items-center gap-2 md:gap-3"
          variants={itemVariants}
        >
          <HeartPulse className="h-4 w-4 md:h-6 md:w-6 text-orange-500" />
          <div>
            <p className="text-xs md:text-sm text-white/70">Monthly Listeners</p>
            <p className="text-sm md:text-xl font-bold text-white">{mockArtist.statistics.monthlyListeners}k</p>
          </div>
        </motion.div>
        <motion.div
          className="bg-black/40 backdrop-blur-sm rounded-lg p-2 md:p-4 flex items-center gap-2 md:gap-3"
          variants={itemVariants}
        >
          <Users className="h-4 w-4 md:h-6 md:w-6 text-orange-500" />
          <div>
            <p className="text-xs md:text-sm text-white/70">Followers</p>
            <p className="text-sm md:text-xl font-bold text-white">{mockArtist.statistics.followers}k</p>
          </div>
        </motion.div>
      </motion.div>

      {/* Video Hero Section - Mobile optimized */}
      <div className="relative h-[50vh] md:h-[90vh] w-screen -mx-[calc(50vw-50%)] overflow-hidden mb-4 md:mb-8">
        <div className="relative h-full w-full">
          {/* Video container with responsive design */}
          <div className="absolute inset-0 w-full h-full">
            {videos && videos[0] && (
              <iframe
                className="w-full h-full object-cover"
                src={`https://www.youtube.com/embed/${getYoutubeVideoId(videos[0].url)}?autoplay=1&mute=1&loop=1&playlist=${getYoutubeVideoId(videos[0].url)}&controls=0&showinfo=0&rel=0`}
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowFullScreen
              ></iframe>
            ) || (
              <div className="w-full h-full bg-gradient-to-br from-orange-500/20 to-red-500/20 flex items-center justify-center">
                <VideoIcon className="w-16 h-16 text-orange-500/50" />
              </div>
            )}
          </div>

          {/* Gradient overlays */}
          <div className="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent opacity-70" />
          <div className="absolute inset-0 bg-gradient-to-r from-orange-500/30 via-transparent to-transparent" />
          <div className="absolute inset-0 bg-gradient-to-b from-black/70 via-transparent to-black/90" />

          {/* Content */}
          <div className="absolute bottom-0 left-0 right-0 p-6 md:p-12">
            <motion.div variants={itemVariants} className="max-w-4xl mx-auto">
              <motion.h1
                className="text-4xl md:text-7xl font-bold mb-6 bg-clip-text text-transparent bg-gradient-to-r from-orange-500 via-orange-300 to-yellow-500"
                variants={itemVariants}
              >
                {mockArtist.name}
              </motion.h1>
              <motion.p
                className="text-xl md:text-2xl font-semibold mb-6 bg-clip-text text-transparent bg-gradient-to-r from-orange-400 to-pink-400"
                variants={itemVariants}
              >
                {mockArtist.genre}
              </motion.p>
              <div className="prose prose-invert max-w-2xl mb-8">
                <motion.p
                  className="text-base md:text-lg text-white/90 leading-relaxed"
                  variants={itemVariants}
                >
                  Un virtuoso del Blues Latin fusion que ha revolucionado la escena musical de Miami. Con más de una década fusionando los ritmos ardientes del Caribe con el alma profunda del Blues, Redwine ha creado un sonido único que refleja la diversidad cultural de Miami. Sus actuaciones en vivo son una experiencia inmersiva donde la pasión latina se encuentra con la autenticidad del Blues.
                </motion.p>
              </div>
              <motion.div className="flex flex-wrap gap-4" variants={itemVariants}>
                <Button
                  size="lg"
                  className="bg-gradient-to-r from-orange-500 to-pink-500 hover:from-orange-600 hover:to-pink-600 text-white shadow-lg hover:shadow-xl transition-all duration-300"
                  onClick={() => setShowMessageDialog(true)}
                >
                  <MessageCircle className="mr-2 h-5 w-5" />
                  Contact Me
                </Button>
                <Button
                  size="lg"
                  variant="outline"
                  className="border-2 border-orange-500 text-orange-500 hover:bg-orange-500 hover:text-white transition-all duration-300"
                  onClick={() => setShowShareDialog(true)}
                >
                  <Share2 className="mr-2 h-5 w-5" />
                  Share Profile
                </Button>
              </motion.div>
            </motion.div>
          </div>
        </div>
      </div>


      {/* Añadir componente de navegación */}
      <SectionNavigation />

      <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div className="lg:col-span-2 space-y-8">
          {/* Contenido principal basado en la sección activa */}
          {activeSection === 'music' && (
            <>
              {/* Featured Release Section */}
              <Card className="p-8 mb-8 bg-gradient-to-r from-orange-500/10 via-orange-500/5 to-transparent border-orange-500/20">
                <motion.div variants={itemVariants} className="flex flex-col md:flex-row md:items-center gap-8">
                  <div className="relative group">
                    {songs && songs[0] ? (
                      <>
                        <div className="w-full md:w-48 h-48 rounded-lg shadow-lg transition-transform group-hover:scale-105 duration-300 bg-gradient-to-br from-orange-500/20 to-red-500/20 flex items-center justify-center overflow-hidden">
                          <img 
                            src={songs[0].coverArt || '/assets/freepik__boostify_music_organe_abstract_icon.png'} 
                            alt={songs[0].name}
                            className="w-full h-full object-cover"
                            onError={(e) => {
                              (e.target as HTMLImageElement).src = '/assets/freepik__boostify_music_organe_abstract_icon.png';
                            }}
                          />
                          <div className="absolute inset-0 bg-black/20 backdrop-blur-sm rounded-xl" />
                        </div>
                        <div className="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity rounded-lg">
                          <div className="absolute bottom-4 left-4">
                            <Button
                              variant="ghost"
                              size="icon"
                              onClick={() => togglePlay(songs[0], 0)}
                              className="rounded-full bg-orange-500 text-white hover:bg-orange-600 hover:scale-110 transition-all duration-300"
                            >
                              {currentTrack === 0 && isPlaying ? (
                                <Pause className="h-8 w-8" />
                              ) : (
                                <Play className="h-8 w-8" />
                              )}
                            </Button>
                          </div>
                        </div>
                      </>
                    ) : (
                      <div className="w-full md:w-48 h-48 rounded-lg bg-orange-500/10 flex items-center justify-center">
                        <Loader2 className="w-8 h-8 animate-spin text-orange-500" />
                      </div>
                    )}
                  </div>
                  <div className="flex-1">
                    <h3 className="text-xl md:text-3xl font-bold mb-2 bg-clip-text text-transparent bg-gradient-to-r from-orange-500 to-pink-500">
                      {songs && songs[0] ? songs[0].name : "Loading..."}
                    </h3>
                    <p className="text-sm md:text-lg text-muted-foreground mb-2 md:mb-4">
                      Added {songs && songs[0] ? new Date(songs[0].createdAt?.seconds * 1000).toLocaleDateString() : "..."}
                    </p>
                    <div className="flex gap-2">
                      <Button
                        size="sm"
                        className="bg-gradient-to-r from-orange-500 to-pink-500 hover:from-orange-600 hover:to-pink-600 shadow-lg hover:shadow-xl transition-all duration-300 md:size-default"
                        onClick={() => songs && songs[0] && togglePlay(songs[0], 0)}
                      >
                        <Music2 className="mr-1 md:mr-2 h-4 w-4 md:h-5 md:w-5" />
                        <span className="text-xs md:text-sm">Play Now</span>
                      </Button>
                      <Button
                        size="sm"
                        variant="outline"
                        className="border-orange-500/30 text-orange-500 hover:bg-orange-500/10"
                      >
                        <DownloadCloud className="mr-1 md:mr-2 h-4 w-4" />
                        <span className="text-xs md:text-sm">Download</span>
                      </Button>
                    </div>
                  </div>
                </motion.div>
              </Card>

              {/* Music Section */}
              <MusicSection />
            </>
          )}

          {activeSection === 'videos' && <VideosSection />}

          {activeSection === 'shows' && (
            <Card className="p-6 bg-black/40 backdrop-blur-sm border-orange-500/20 hover:border-orange-500/40 transition-all duration-300">
              <motion.div variants={itemVariants}>
                <div className="flex items-center justify-between mb-6">
                  <h3 className="text-2xl font-semibold flex items-center bg-clip-text text-transparent bg-gradient-to-r from-orange-500 to-red-500">
                    <Calendar className="w-6 h-6 mr-2 text-orange-500" />
                    Upcoming Shows
                  </h3>
                  <Button variant="ghost" size="sm" className="text-orange-500 hover:text-orange-400">
                    <span>View All</span>
                    <CalendarRange className="ml-2 h-4 w-4" />
                  </Button>
                </div>
                <div className="space-y-4">
                  {mockArtist.upcomingShows.length > 0 ? (
                    mockArtist.upcomingShows.map((show) => (
                      <div
                        key={show.id}
                        className="flex md:flex-row flex-col md:items-center md:justify-between p-5 rounded-lg bg-gradient-to-r from-black/50 to-black/30 border border-orange-500/10 hover:border-orange-500/30 transition-all duration-300"
                      >
                        <div>
                          <p className="font-medium text-lg bg-clip-text text-transparent bg-gradient-to-r from-orange-500 to-pink-500">{show.venue}</p>
                          <p className="text-sm text-white/70 mt-1">{show.city}</p>
                          <div className="flex items-center gap-2 mt-2">
                            <Calendar className="text-orange-500 h-4 w-4" />
                            <p className="text-sm text-orange-500/90">
                              {new Date(show.date).toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                            </p>
                          </div>
                        </div>
                        <div className="mt-3 md:mt-0 flex flex-col md:items-end gap-2">
                          <Badge variant="outline" className="border-orange-500/50 text-orange-400">
                            <TicketCheck className="mr-1 h-3 w-3" />
                            Tickets available
                          </Badge>
                          <Button
                            className="bg-gradient-to-r from-orange-500 to-pink-500 hover:from-orange-600 hover:to-pink-600 text-white shadow-lg hover:shadow-xl transition-all duration-300"
                            onClick={() => window.open(show.ticketUrl, "_blank")}
                          >
                            <Ticket className="mr-2 h-4 w-4" />
                            Get Tickets
                          </Button>
                        </div>
                      </div>
                    ))
                  ) : (
                    <div className="bg-black/20 rounded-lg p-8 text-center">
                      <CalendarRange className="h-12 w-12 text-orange-500/40 mx-auto mb-3" />
                      <p className="text-orange-100/70">No hay shows programados</p>
                      <p className="text-sm text-orange-300/50 mt-2">Los conciertos que programes aparecerán aquí</p>
                      <Button variant="outline" className="mt-4 border-orange-500/30 text-orange-400 hover:bg-orange-500/10">
                        <PlusCircle className="h-4 w-4 mr-2" />
                        Añadir show
                      </Button>
                    </div>
                  )}
                </div>
              </motion.div>
            </Card>
          )}

          {activeSection === 'merch' && (
            <Card className="p-6 bg-black/40 backdrop-blur-sm border-orange-500/20 hover:border-orange-500/40 transition-all duration-300">
              <motion.div variants={itemVariants}>
                <div className="flex items-center justify-between mb-6">
                  <h3 className="text-2xl font-semibold flex items-center bg-clip-text text-transparent bg-gradient-to-r from-orange-500 to-red-500">
                    <ShoppingBag className="w-6 h-6 mr-2 text-orange-500" />
                    Official Merchandise
                  </h3>
                  <Button variant="ghost" size="sm" className="text-orange-500 hover:text-orange-400">
                    <span>View All</span>
                    <Store className="ml-2 h-4 w-4" />
                  </Button>
                </div>
                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                  {mockArtist.merchandise.map((item) => (
                    <motion.div
                      key={item.id}
                      className="group relative rounded-lg overflow-hidden bg-gradient-to-br from-black/50 to-black/30 border border-orange-500/10 hover:border-orange-500/30"
                      whileHover={{ 
                        scale: 1.03,
                        boxShadow: "0 10px 30px -15px rgba(249, 115, 22, 0.4)"
                      }}
                      transition={{ duration: 0.2 }}
                    >
                      <div className="aspect-square overflow-hidden relative">
                        <img
                          src={item.imageUrl}
                          alt={item.name}
                          className="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                        />
                        <div className="absolute inset-0 bg-gradient-to-t from-black/80 via-black/30 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                          <div className="absolute bottom-0 left-0 right-0 p-4 transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300">
                            <div className="space-y-2">
                              <p className="text-white font-medium text-lg">{item.name}</p>
                              <p className="text-orange-400 font-bold text-xl">{item.price}</p>
                              <p className="text-white/80 text-sm line-clamp-2">{item.description}</p>
                              <Button 
                                className="mt-2 bg-gradient-to-r from-orange-500 to-pink-500 hover:from-orange-600 hover:to-pink-600 text-white w-full"
                                onClick={() => window.open(item.url, "_blank")}
                              >
                                <ShoppingCart className="mr-2 h-4 w-4" />
                                Comprar Ahora
                              </Button>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div className="p-4 bg-black/40">
                        <p className="font-medium line-clamp-1">{item.name}</p>
                        <div className="flex justify-between items-center mt-1">
                          <p className="text-orange-400 font-semibold">{item.price}</p>
                          <Badge variant="secondary" className="bg-orange-500/20 text-orange-300 text-xs">
                            {item.category}
                          </Badge>
                        </div>
                      </div>
                    </motion.div>
                  ))}
                </div>
              </motion.div>
            </Card>
          )}
        </div>

        <div className="space-y-8 lg:mt-0 mt-8">
          <Card className="p-6">
            <motion.div variants={itemVariants}>
              <h3 className="text-2xl font-semibold mb-6 flex items-center bg-clip-text text-transparent bg-gradient-to-r from-orange-500 to-red-500">
                <User className="w-6 h-6 mr-2 text-orange-500" />
                Contact
              </h3>
              <div className="space-y-4">
                <div className="flex items-center">
                  <MapPin className="w-5 h-5 text-orange-500 mr-3" />
                  <span>{mockArtist.location}</span>
                </div>
                <div className="flex items-center">
                  <Mail className="w-5 h-5 text-orange-500 mr-3" />
                  <a href={`mailto:${mockArtist.email}`} className="hover:text-orange-500">
                    {mockArtist.email}
                  </a>
                </div>
                <div className="flex items-center">
                  <Phone className="w-5 h-5 text-orange-50 mr-3" />
                  <a href={`tel:${mockArtist.phone}`} className="hover:text-orange-500">
                    {mockArtist.phone}
                  </a>
                </div>
                <div className="flex items-center">
                  <Globe className="w-5 h-5 text-orange-500 mr-3" />
                  <a
                                        href={mockArtist.website}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="hover:text-orange-500"
                  >
                    {mockArtist.website}
                  </a>
                </div>
              </div>
            </motion.div>
          </Card>
          <Card className="p-6">
            <motion.div variants={itemVariants}>
              <h3 className="text-2xl font-semibold mb-6 flex items-center bg-clip-text text-transparent bg-gradient-to-r from-orange-500 to-red-500">
                <Share2 className="w-6 h-6 mr-2 text-orange-500" />
                Connect & Follow
              </h3>
              <div className="grid grid-cols-2 gap-4">
                <Button
                  className="w-full bg-[#E1306C] hover:bg-[#C13584] transition-all duration-300 hover:scale-105"
                  onClick={() => window.open(mockArtist.socialMedia.instagram, "_blank")}
                >
                  <Instagram className="mr-2 h-5 w-5" />
                  Instagram
                </Button>
                <Button
                  className="w-full bg-[#1DA1F2] hover:bg-[#1A91DA] transition-all duration-300 hover:scale-105"
                  onClick={() => window.open(mockArtist.socialMedia.twitter, "_blank")}
                >
                  <Twitter className="mr-2 h-5 w-5" />
                  Twitter
                </Button>
                <Button
                  className="w-full bg-[#FF0000] hover:bg-[#CC0000] transition-all duration-300 hover:scale-105"
                  onClick={() => window.open(mockArtist.socialMedia.youtube, "_blank")}
                >
                  <Youtube className="mr-2 h-5 w-5" />
                  YouTube
                </Button>
                <Link href="/smart-cards">
                  <Button
                    className="w-full bg-gradient-to-r from-orange-500 to-pink-500 hover:from-orange-600 hover:to-pink-600 transition-all duration-300 hover:scale-105"
                  >
                    <CreditCard className="mr-2 h-5 w-5" />
                    Get Smart Cards
                  </Button>
                </Link>
              </div>
            </motion.div>
          </Card>
        </div>
      </div>

      <Dialog open={showMessageDialog} onOpenChange={setShowMessageDialog}>
        <DialogContent className="sm:max-w-[425px]">
          <DialogHeader>
            <DialogTitle>Send Message to {mockArtist.name}</DialogTitle>
          </DialogHeader>
          <div className="grid gap-4 py-4">
            <div className="grid grid-cols-4 items-center gap-4">
              <textarea
                className="col-span-4 h-32 p-2 rounded-md border"
                placeholder="Write your message here..."
              />
            </div>
          </div>
          <div className="flex justify-end gap-4">
            <Button variant="ghost" onClick={() => setShowMessageDialog(false)}>
              Cancel
            </Button>
            <Button className="bg-orange-500 hover:bg-orange-600 hover:bg-orange-600 transition-all duration-300 hover:scale-105">
              Send Message
            </Button>
          </div>
        </DialogContent>
      </Dialog>
      <ShareDialog
        isOpen={showShareDialog}
        onClose={() => setShowShareDialog(false)}
        artistName={mockArtist.name}
        artistUrl={artistId}
      />
    </motion.div>
  );
}

export const mockArtist = {
  name: "Redwine",
  genre: "Blues Latin Fusion",
  location: "Miami, FL",
  email: "booking@redwinemusic.com",
  phone: "+1 (305) 555-0123",
  website: "https://redwinemusic.com",
  socialMedia: {
    instagram: "https://instagram.com/redwinemusic",
    twitter: "https://twitter.com/redwinemusic",
    youtube: "https://youtube.com/redwinemusic",
  },
  newRelease: {
    title: "New Release Title",
    coverArt: "/path/to/cover/art.jpg",
    releaseDate: new Date().toISOString(),
  },
  upcomingShows: [
    {
      id: "1",
      venue: "Venue Name",
      city: "City, State",
      date: new Date().toISOString(),
      ticketUrl: "https://example.com/tickets",
    },
  ],
  merchandise: [
    {
      id: "1",
      name: "La Vida Es de los Que Saben - Vinyl Edition",
      price: "$29.99",
      imageUrl: "/assets/Merchandise/vinil.jpeg",
      description: "Edición especial en vinilo con portada artística y notas exclusivas firmadas por Redwine",
      inStock: true,
      category: "Music",
      url: "#",
    },
    {
      id: "2",
      name: "Latin Blues Tour 2024 - Official Merch",
      price: "$24.99",
      imageUrl: "/assets/Merchandise/camiseta.jpeg",
      description: "Camiseta oficial del tour con diseño inspirado en 'Ella o el alcohol'",
      inStock: true,
      category: "Apparel",
      sizes: ["S", "M", "L", "XL"],
      url: "#",
    },
    {
      id: "3",
      name: "Colección Arte Latino Blues",
      price: "$19.99",
      imageUrl: "/assets/Merchandise/print.jpeg",
      description: "Set de prints artísticos firmados inspirados en la fusión del Blues Latino de Redwine",
      inStock: true,
      category: "Art",
      url: "#",
    },
  ],
  statistics: {
    monthlyListeners: 75,
    totalStreams: 100000,
    followers: 5000,
  },
};