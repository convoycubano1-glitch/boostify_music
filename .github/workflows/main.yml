name: ğŸš€ Multi-Campaign Email Warmup

on:
  schedule:
    # Ejecutar cada dÃ­a a las 14:00 UTC (9:00 AM EST / 10:00 AM EDT)
    - cron: '0 14 * * *'
  workflow_dispatch:
    inputs:
      campaigns:
        description: 'CampaÃ±as a ejecutar (ALL, INDUSTRY, ARTISTS_1, ARTISTS_2, ARTISTS_3, ARTISTS_4)'
        required: false
        default: 'ALL'
        type: string
      preview_mode:
        description: 'Modo preview (enviar a convoycubano@gmail.com)'
        required: false
        default: 'false'
        type: boolean

jobs:
  warmup-emails:
    runs-on: ubuntu-latest
    environment: production
    
    env:
      OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      SUPABASE_CONNECTION_STRING: ${{ secrets.SUPABASE_CONNECTION_STRING }}
      RESEND_API_INDUSTRY: ${{ secrets.RESEND_API_INDUSTRY }}
      RESEND_API_ARTISTS_1: ${{ secrets.RESEND_API_ARTISTS_1 }}
      RESEND_API_ARTISTS_2: ${{ secrets.RESEND_API_ARTISTS_2 }}
      RESEND_API_ARTISTS_3: ${{ secrets.RESEND_API_ARTISTS_3 }}
      RESEND_API_ARTISTS_4: ${{ secrets.RESEND_API_ARTISTS_4 }}
      APIFY_API_INDUSTRY: ${{ secrets.APIFY_API_INDUSTRY }}
      APIFY_API_ARTISTS_1: ${{ secrets.APIFY_API_ARTISTS_1 }}
      APIFY_API_ARTISTS_2: ${{ secrets.APIFY_API_ARTISTS_2 }}
      APIFY_API_ARTISTS_3: ${{ secrets.APIFY_API_ARTISTS_3 }}
      APIFY_API_ARTISTS_4: ${{ secrets.APIFY_API_ARTISTS_4 }}
    
    steps:
    - name: ğŸ“¥ Checkout repository
      uses: actions/checkout@v4

    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'

    - name: ğŸ“¦ Install dependencies
      run: npm ci

    - name: ğŸ“Š Check lead statistics
      run: |
        echo "ğŸ“Š Verificando estadÃ­sticas de leads..."
        node scripts/check-leads.cjs

    - name: ğŸš€ Send warmup emails - INDUSTRY
      if: ${{ github.event.inputs.campaigns == 'ALL' || github.event.inputs.campaigns == 'INDUSTRY' || github.event_name == 'schedule' }}
      run: |
        echo "ğŸ“§ Ejecutando campaÃ±a INDUSTRY (boostifymusic.com)..."
        node scripts/warmup-sender-v2.cjs INDUSTRY
      continue-on-error: true

    - name: ğŸ¤ Send warmup emails - ARTISTS_1
      if: ${{ github.event.inputs.campaigns == 'ALL' || github.event.inputs.campaigns == 'ARTISTS_1' || github.event_name == 'schedule' }}
      run: |
        echo "ğŸ“§ Ejecutando campaÃ±a ARTISTS_1 (boostifymusic.site)..."
        node scripts/warmup-sender-v2.cjs ARTISTS_1
      continue-on-error: true

    - name: ğŸ§ Send warmup emails - ARTISTS_2
      if: ${{ github.event.inputs.campaigns == 'ALL' || github.event.inputs.campaigns == 'ARTISTS_2' || github.event_name == 'schedule' }}
      run: |
        echo "ğŸ“§ Ejecutando campaÃ±a ARTISTS_2 (boostifymusic.space)..."
        node scripts/warmup-sender-v2.cjs ARTISTS_2
      continue-on-error: true

    - name: ğŸµ Send warmup emails - ARTISTS_3
      if: ${{ github.event.inputs.campaigns == 'ALL' || github.event.inputs.campaigns == 'ARTISTS_3' || github.event_name == 'schedule' }}
      run: |
        echo "ğŸ“§ Ejecutando campaÃ±a ARTISTS_3 (boostifymusic.sbs)..."
        node scripts/warmup-sender-v2.cjs ARTISTS_3
      continue-on-error: true

    - name: ğŸ¹ Send warmup emails - ARTISTS_4
      if: ${{ github.event.inputs.campaigns == 'ALL' || github.event.inputs.campaigns == 'ARTISTS_4' || github.event_name == 'schedule' }}
      run: |
        echo "ğŸ“§ Ejecutando campaÃ±a ARTISTS_4 (boostifymusic.online)..."
        node scripts/warmup-sender-v2.cjs ARTISTS_4
      continue-on-error: true

    - name: ğŸ“ˆ Final statistics
      run: |
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸ“Š RESUMEN FINAL"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        node scripts/check-leads.cjs
