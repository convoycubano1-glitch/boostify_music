name: ğŸ’¼ Investor/Industry Email Sequence (13+ Templates)

# Solo se activa manualmente - TÃš decides cuÃ¡ndo
on:
  workflow_dispatch:
    inputs:
      template_id:
        description: 'Template de email a usar'
        required: true
        default: 'cold_outreach_direct'
        type: choice
        options:
          # Cold Outreach (5 variantes A/B testing)
          - 'cold_outreach_direct'      # A - Direct Pitch
          - 'cold_outreach_problem'     # B - Problem First
          - 'cold_outreach_revenue'     # C - Revenue Projections
          - 'cold_outreach_social'      # D - Social Proof
          - 'cold_outreach_urgency'     # E - Limited Opportunity
          # Warm Intro
          - 'warm_vc_intro'             # VC/Angel Introduction
          - 'record_label_exec'         # Record Label Executive
          # Follow-ups
          - 'follow_up_3d'              # 3 Days Follow-up
          - 'follow_up_7d'              # 7 Days Follow-up
          - 'follow_up_10d'             # 10 Days Value Add
          - 'follow_up_14d'             # 14 Days Breakup
          - 'follow_up_21d'             # 21 Days Hail Mary
      max_emails:
        description: 'MÃ¡ximo de emails a enviar'
        required: false
        default: '25'
        type: string
      preview_mode:
        description: 'Modo preview (solo a convoycubano@gmail.com)'
        required: false
        default: 'true'
        type: boolean
      target_segment:
        description: 'Segmento objetivo'
        required: false
        default: 'all'
        type: choice
        options:
          - 'all'
          - 'vc_fund'
          - 'record_label'
          - 'angel_investor'
          - 'music_tech_investor'
          - 'industry_consultant'

jobs:
  send-investor-sequence:
    runs-on: ubuntu-latest
    environment: production
    
    env:
      OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      SUPABASE_CONNECTION_STRING: ${{ secrets.SUPABASE_CONNECTION_STRING }}
      BREVO_API_KEY: ${{ secrets.BREVO_API_KEY }}
      APIFY_API_INDUSTRY: ${{ secrets.APIFY_API_INDUSTRY }}
    
    steps:
    - name: ğŸ“¥ Checkout repository
      uses: actions/checkout@v4

    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'

    - name: ğŸ“¦ Install dependencies
      run: npm ci

    - name: ğŸ¯ Display configuration
      run: |
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸ’¼ INVESTOR/INDUSTRY EMAIL SEQUENCE"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸ“§ Template: ${{ github.event.inputs.template_id }}"
        echo "ğŸ“Š MÃ¡ximo emails: ${{ github.event.inputs.max_emails }}"
        echo "ğŸ¯ Segmento: ${{ github.event.inputs.target_segment }}"
        echo "ğŸ”„ Preview mode: ${{ github.event.inputs.preview_mode }}"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

    - name: ğŸ“Š Check investor lead statistics
      run: node scripts/check-leads.cjs

    - name: ğŸ’¼ Send Investor Email - ${{ github.event.inputs.template_id }}
      run: |
        node scripts/investor-sequence-sender.cjs \
          --template=${{ github.event.inputs.template_id }} \
          --max=${{ github.event.inputs.max_emails }} \
          --segment=${{ github.event.inputs.target_segment }} \
          --preview=${{ github.event.inputs.preview_mode }}
      continue-on-error: true

    - name: ğŸ“ˆ Final statistics
      run: |
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸ“Š CAMPAÃ‘A COMPLETADA"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        node scripts/check-leads.cjs
