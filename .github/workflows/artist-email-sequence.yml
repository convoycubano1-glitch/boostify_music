name: ğŸµ Artist Email Sequence (10 HTML Emails)

# Solo se activa manualmente - TÃš decides cuÃ¡ndo
on:
  workflow_dispatch:
    inputs:
      sequence_number:
        description: 'NÃºmero de email en la secuencia (1-10)'
        required: true
        default: '1'
        type: choice
        options:
          - '1'
          - '2'
          - '3'
          - '4'
          - '5'
          - '6'
          - '7'
          - '8'
          - '9'
          - '10'
      max_emails:
        description: 'MÃ¡ximo de emails a enviar'
        required: false
        default: '50'
        type: string
      preview_mode:
        description: 'Modo preview (solo a convoycubano@gmail.com)'
        required: false
        default: 'true'
        type: boolean

jobs:
  send-artist-sequence:
    runs-on: ubuntu-latest
    environment: production
    
    env:
      OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      SUPABASE_CONNECTION_STRING: ${{ secrets.SUPABASE_CONNECTION_STRING }}
      BREVO_API_KEY: ${{ secrets.BREVO_API_KEY }}
      RESEND_API_ARTISTS_1: ${{ secrets.RESEND_API_ARTISTS_1 }}
      RESEND_API_ARTISTS_2: ${{ secrets.RESEND_API_ARTISTS_2 }}
      RESEND_API_ARTISTS_3: ${{ secrets.RESEND_API_ARTISTS_3 }}
      RESEND_API_ARTISTS_4: ${{ secrets.RESEND_API_ARTISTS_4 }}
    
    steps:
    - name: ğŸ“¥ Checkout repository
      uses: actions/checkout@v4

    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'

    - name: ğŸ“¦ Install dependencies
      run: npm ci

    - name: ğŸ¯ Display configuration
      run: |
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸµ ARTIST EMAIL SEQUENCE"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸ“§ Email en secuencia: #${{ github.event.inputs.sequence_number }}/10"
        echo "ğŸ“Š MÃ¡ximo emails: ${{ github.event.inputs.max_emails }}"
        echo "ğŸ”„ Preview mode: ${{ github.event.inputs.preview_mode }}"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

    - name: ğŸ“Š Check lead statistics
      run: node scripts/check-leads.cjs

    - name: ğŸµ Send Artist Sequence Email #${{ github.event.inputs.sequence_number }}
      run: |
        node scripts/artist-sequence-sender.cjs \
          --sequence=${{ github.event.inputs.sequence_number }} \
          --max=${{ github.event.inputs.max_emails }} \
          --preview=${{ github.event.inputs.preview_mode }}
      continue-on-error: true

    - name: ğŸ“ˆ Final statistics
      run: |
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸ“Š SECUENCIA COMPLETADA"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        node scripts/check-leads.cjs
